(function(c){"function"===typeof define&&define.amd?define(["jquery"],c):"object"===typeof exports&&"function"===typeof require?c(require("jquery")):c(jQuery)})(function(c){function g(a,b){var d=function(){},d={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:g.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:d,onSearchComplete:d,onSearchError:d,
    containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(a,b,d){return-1!==a.value.toLowerCase().indexOf(d)},paramName:"query",transformResult:function(a){return"string"===typeof a?c.parseJSON(a):a},showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1};this.element=a;this.el=c(a);this.suggestions=[];this.badQueries=[];this.selectedIndex=-1;this.currentValue=
    this.element.value;this.intervalId=0;this.cachedResponse={};this.onChange=this.onChangeInterval=null;this.isLocal=!1;this.noSuggestionsContainer=this.suggestionsContainer=null;this.options=c.extend({},d,b);this.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"};this.hint=null;this.hintValue="";this.selection=null;this.initialize();this.setOptions(b)}var k=function(){return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(a){var b=
    document.createElement("div");b.className=a;b.style.position="absolute";b.style.display="none";return b}}}();g.utils=k;c.Autocomplete=g;g.formatResult=function(a,b){var d="("+k.escapeRegExChars(b)+")";return a.value.replace(new RegExp(d,"gi"),"<strong>$1</strong>")};g.prototype={killerFn:null,initialize:function(){var a=this,b="."+a.classes.suggestion,d=a.classes.selected,e=a.options,f;a.element.setAttribute("autocomplete","off");a.killerFn=function(b){0===c(b.target).closest("."+a.options.containerClass).length&&
(a.killSuggestions(),a.disableKillerFn())};a.noSuggestionsContainer=c('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0);a.suggestionsContainer=g.utils.createNode(e.containerClass);f=c(a.suggestionsContainer);f.appendTo(e.appendTo);"auto"!==e.width&&f.width(e.width);f.on("mouseover.autocomplete",b,function(){a.activate(c(this).data("index"))});f.on("mouseout.autocomplete",function(){a.selectedIndex=-1;f.children("."+d).removeClass(d)});f.on("click.autocomplete",
    b,function(){a.select(c(this).data("index"))});a.fixPositionCapture=function(){a.visible&&a.fixPosition()};c(window).on("resize.autocomplete",a.fixPositionCapture);a.el.on("keydown.autocomplete",function(b){a.onKeyPress(b)});a.el.on("keyup.autocomplete",function(b){a.onKeyUp(b)});a.el.on("blur.autocomplete",function(){a.onBlur()});a.el.on("focus.autocomplete",function(){a.onFocus()});a.el.on("change.autocomplete",function(b){a.onKeyUp(b)});a.el.on("input.autocomplete",function(b){a.onKeyUp(b)})},
    onFocus:function(){this.fixPosition();if(this.options.minChars<=this.el.val().length)this.onValueChange()},onBlur:function(){this.enableKillerFn()},setOptions:function(a){var b=this.options;c.extend(b,a);if(this.isLocal=c.isArray(b.lookup))b.lookup=this.verifySuggestionsFormat(b.lookup);b.orientation=this.validateOrientation(b.orientation,"bottom");c(this.suggestionsContainer).css({"max-height":b.maxHeight+"px",width:b.width+"px","z-index":b.zIndex})},clearCache:function(){this.cachedResponse={};
        this.badQueries=[]},clear:function(){this.clearCache();this.currentValue="";this.suggestions=[]},disable:function(){this.disabled=!0;clearInterval(this.onChangeInterval);this.currentRequest&&this.currentRequest.abort()},enable:function(){this.disabled=!1},fixPosition:function(){var a=c(this.suggestionsContainer),b=a.parent().get(0);if(b===document.body||this.options.forceFixPosition){var d=this.options.orientation,e=a.outerHeight(),f=this.el.outerHeight(),m=this.el.offset(),h={top:m.top,left:m.left};
        if("auto"===d)var d=c(window).height(),n=c(window).scrollTop(),g=-n+m.top-e,d=Math.max(g,n+d-(m.top+f+e))===g?"top":"bottom";h.top="top"===d?h.top+-e:h.top+f;b!==document.body&&(b=a.css("opacity"),this.visible||a.css("opacity",0).show(),e=a.offsetParent().offset(),h.top-=e.top,h.left-=e.left,this.visible||a.css("opacity",b).hide());"auto"===this.options.width&&(h.width=this.el.outerWidth()-2+"px");a.css(h)}},enableKillerFn:function(){c(document).on("click.autocomplete",this.killerFn)},disableKillerFn:function(){c(document).off("click.autocomplete",
        this.killerFn)},killSuggestions:function(){var a=this;a.stopKillSuggestions();a.intervalId=window.setInterval(function(){a.hide();a.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var a=this.el.val().length,b=this.element.selectionStart;return"number"===typeof b?b===a:document.selection?(b=document.selection.createRange(),b.moveStart("character",-a),a===b.text.length):!0},onKeyPress:function(a){if(!this.disabled&&!this.visible&&
        40===a.which&&this.currentValue)this.suggest();else if(!this.disabled&&this.visible){switch(a.which){case 27:this.el.val(this.currentValue);this.hide();break;case 39:if(this.hint&&this.options.onHint&&this.isCursorAtEnd()){this.selectHint();break}return;case 9:if(this.hint&&this.options.onHint){this.selectHint();return}if(-1===this.selectedIndex){this.hide();return}this.select(this.selectedIndex);if(!1===this.options.tabDisabled)return;break;case 13:if(-1===this.selectedIndex){this.hide();return}this.select(this.selectedIndex);
        break;case 38:this.moveUp();break;case 40:this.moveDown();break;default:return}a.stopImmediatePropagation();a.preventDefault()}},onKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case 38:case 40:return}clearInterval(b.onChangeInterval);if(b.currentValue!==b.el.val())if(b.findBestHint(),0<b.options.deferRequestBy)b.onChangeInterval=setInterval(function(){b.onValueChange()},b.options.deferRequestBy);else b.onValueChange()}},onValueChange:function(){var a=this.options,b=this.el.val(),d=
        this.getQuery(b);this.selection&&this.currentValue!==d&&(this.selection=null,(a.onInvalidateSelection||c.noop).call(this.element));clearInterval(this.onChangeInterval);this.currentValue=b;this.selectedIndex=-1;if(a.triggerSelectOnValidInput&&(b=this.findSuggestionIndex(d),-1!==b)){this.select(b);return}d.length<a.minChars?this.hide():this.getSuggestions(d)},findSuggestionIndex:function(a){var b=-1,d=a.toLowerCase();c.each(this.suggestions,function(a,c){if(c.value.toLowerCase()===d)return b=a,!1});
        return b},getQuery:function(a){var b=this.options.delimiter;if(!b)return a;a=a.split(b);return c.trim(a[a.length-1])},getSuggestionsLocal:function(a){var b=this.options,d=a.toLowerCase(),e=b.lookupFilter,f=parseInt(b.lookupLimit,10),b={suggestions:c.grep(b.lookup,function(b){return e(b,a,d)})};f&&b.suggestions.length>f&&(b.suggestions=b.suggestions.slice(0,f));return b},getSuggestions:function(a){var b,d=this,e=d.options,f=e.serviceUrl,g,h;e.params[e.paramName]=a;g=e.ignoreParams?null:e.params;!1!==
    e.onSearchStart.call(d.element,e.params)&&(c.isFunction(e.lookup)?e.lookup(a,function(b){d.suggestions=b.suggestions;d.suggest();e.onSearchComplete.call(d.element,a,b.suggestions)}):(d.isLocal?b=d.getSuggestionsLocal(a):(c.isFunction(f)&&(f=f.call(d.element,a)),h=f+"?"+c.param(g||{}),b=d.cachedResponse[h]),b&&c.isArray(b.suggestions)?(d.suggestions=b.suggestions,d.suggest(),e.onSearchComplete.call(d.element,a,b.suggestions)):d.isBadQuery(a)?e.onSearchComplete.call(d.element,a,[]):(d.currentRequest&&
    d.currentRequest.abort(),b={url:f,data:g,type:e.type,dataType:e.dataType},c.extend(b,e.ajaxSettings),d.currentRequest=c.ajax(b).done(function(b){d.currentRequest=null;b=e.transformResult(b);d.processResponse(b,a,h);e.onSearchComplete.call(d.element,a,b.suggestions)}).fail(function(b,c,f){e.onSearchError.call(d.element,a,b,c,f)}))))},isBadQuery:function(a){if(!this.options.preventBadQueries)return!1;for(var b=this.badQueries,d=b.length;d--;)if(0===a.indexOf(b[d]))return!0;return!1},hide:function(){this.visible=
        !1;this.selectedIndex=-1;clearInterval(this.onChangeInterval);c(this.suggestionsContainer).hide();this.signalHint(null)},suggest:function(){if(0===this.suggestions.length)this.options.showNoSuggestionNotice?this.noSuggestions():this.hide();else{var a=this.options,b=a.groupBy,d=a.formatResult,e=this.getQuery(this.currentValue),f=this.classes.suggestion,g=this.classes.selected,h=c(this.suggestionsContainer),n=c(this.noSuggestionsContainer),k=a.beforeRender,l="",p,q;if(a.triggerSelectOnValidInput&&(q=
            this.findSuggestionIndex(e),-1!==q)){this.select(q);return}c.each(this.suggestions,function(a,c){if(b){var h=l,g;g=c.data[b];p===g?g="":(p=g,g='<div class="autocomplete-group"><strong>'+p+"</strong></div>");l=h+g}l+='<div class="'+f+'" data-index="'+a+'">'+d(c,e)+"</div>"});this.adjustContainerWidth();n.detach();h.html(l);c.isFunction(k)&&k.call(this.element,h);this.fixPosition();h.show();a.autoSelectFirst&&(this.selectedIndex=0,h.scrollTop(0),h.children().first().addClass(g));this.visible=!0;this.findBestHint()}},
    noSuggestions:function(){var a=c(this.suggestionsContainer),b=c(this.noSuggestionsContainer);this.adjustContainerWidth();b.detach();a.empty();a.append(b);this.fixPosition();a.show();this.visible=!0},adjustContainerWidth:function(){var a=this.options,b=c(this.suggestionsContainer);"auto"===a.width&&(a=this.el.outerWidth()-2,b.width(0<a?a:300))},findBestHint:function(){var a=this.el.val().toLowerCase(),b=null;a&&(c.each(this.suggestions,function(d,c){var f=0===c.value.toLowerCase().indexOf(a);f&&(b=
        c);return!f}),this.signalHint(b))},signalHint:function(a){var b="";a&&(b=this.currentValue+a.value.substr(this.currentValue.length));this.hintValue!==b&&(this.hintValue=b,this.hint=a,(this.options.onHint||c.noop)(b))},verifySuggestionsFormat:function(a){return a.length&&"string"===typeof a[0]?c.map(a,function(a){return{value:a,data:null}}):a},validateOrientation:function(a,b){a=c.trim(a||"").toLowerCase();-1===c.inArray(a,["auto","bottom","top"])&&(a=b);return a},processResponse:function(a,b,d){var c=
        this.options;a.suggestions=this.verifySuggestionsFormat(a.suggestions);c.noCache||(this.cachedResponse[d]=a,c.preventBadQueries&&0===a.suggestions.length&&this.badQueries.push(b));b===this.getQuery(this.currentValue)&&(this.suggestions=a.suggestions,this.suggest())},activate:function(a){var b=this.classes.selected,d=c(this.suggestionsContainer),e=d.find("."+this.classes.suggestion);d.find("."+b).removeClass(b);this.selectedIndex=a;return-1!==this.selectedIndex&&e.length>this.selectedIndex?(a=e.get(this.selectedIndex),
        c(a).addClass(b),a):null},selectHint:function(){var a=c.inArray(this.hint,this.suggestions);this.select(a)},select:function(a){this.hide();this.onSelect(a)},moveUp:function(){-1!==this.selectedIndex&&(0===this.selectedIndex?(c(this.suggestionsContainer).children().first().removeClass(this.classes.selected),this.selectedIndex=-1,this.el.val(this.currentValue),this.findBestHint()):this.adjustScroll(this.selectedIndex-1))},moveDown:function(){this.selectedIndex!==this.suggestions.length-1&&this.adjustScroll(this.selectedIndex+
    1)},adjustScroll:function(a){var b=this.activate(a);if(b){var d,e,f=c(b).outerHeight(),b=b.offsetTop;d=c(this.suggestionsContainer).scrollTop();e=d+this.options.maxHeight-f;b<d?c(this.suggestionsContainer).scrollTop(b):b>e&&c(this.suggestionsContainer).scrollTop(b-this.options.maxHeight+f);this.el.val(this.getValue(this.suggestions[a].value));this.signalHint(null)}},onSelect:function(a){var b=this.options.onSelect;a=this.suggestions[a];this.currentValue=this.getValue(a.value);this.currentValue!==
    this.el.val()&&this.el.val(this.currentValue);this.signalHint(null);this.suggestions=[];this.selection=a;c.isFunction(b)&&b.call(this.element,a)},getValue:function(a){var b=this.options.delimiter,c;if(!b)return a;c=this.currentValue;b=c.split(b);return 1===b.length?a:c.substr(0,c.length-b[b.length-1].length)+a},dispose:function(){this.el.off(".autocomplete").removeData("autocomplete");this.disableKillerFn();c(window).off("resize.autocomplete",this.fixPositionCapture);c(this.suggestionsContainer).remove()}};
    c.fn.autocomplete=c.fn.devbridgeAutocomplete=function(a,b){return 0===arguments.length?this.first().data("autocomplete"):this.each(function(){var d=c(this),e=d.data("autocomplete");if("string"===typeof a){if(e&&"function"===typeof e[a])e[a](b)}else e&&e.dispose&&e.dispose(),e=new g(this,a),d.data("autocomplete",e)})}});